<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Source Themes Academic 4.8.0"><meta name=description content="Introduction Overview Keyple SDK is supported by the Operating System Android. As Keyple request low level reader access, the key features of the SDK relies on components called &lsquo;Plugins&rsquo;.
Keyple Android Plugins are low level implementation of Keyple contracts described in the section &lsquo;Develop a plugin&rsquo; in Developer guide."><link rel=alternate hreflang=en-us href=/keyple-website/docs/build-your-first-app/android-app/><link rel=preconnect href=https://fonts.gstatic.com crossorigin><meta name=theme-color content="#1D87BB"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css integrity="sha256-FMvZuGapsJLjouA6k7Eo2lusoAX9i0ShlWFG6qt7SLc=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/styles/github.min.css crossorigin=anonymous title=hl-light><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/styles/dracula.min.css crossorigin=anonymous title=hl-dark disabled><script src=https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin=anonymous async></script><link rel=stylesheet href="https://fonts.googleapis.com/css?family=%7CWork+Sans:ital,wght@0,300;1,500&display=swap"><link rel=stylesheet href=/keyple-website/css/academic.css><link rel=manifest href=/keyple-website/index.webmanifest><link rel=icon type=image/png href=/keyple-website/images/icon_hu16db34b3636b127457de39ca2fab620f_9845_32x32_fill_lanczos_center_2.png><link rel=apple-touch-icon type=image/png href=/keyple-website/images/icon_hu16db34b3636b127457de39ca2fab620f_9845_192x192_fill_lanczos_center_2.png><link rel=canonical href=/keyple-website/docs/build-your-first-app/android-app/><meta property="twitter:card" content="summary"><meta property="twitter:site" content="@keyple_org"><meta property="twitter:creator" content="@keyple_org"><meta property="og:site_name" content="Eclipse Keyple"><meta property="og:url" content="/keyple-website/docs/build-your-first-app/android-app/"><meta property="og:title" content="Build your First Android Application | Eclipse Keyple"><meta property="og:description" content="Introduction Overview Keyple SDK is supported by the Operating System Android. As Keyple request low level reader access, the key features of the SDK relies on components called &lsquo;Plugins&rsquo;.
Keyple Android Plugins are low level implementation of Keyple contracts described in the section &lsquo;Develop a plugin&rsquo; in Developer guide."><meta property="og:image" content="/keyple-website/images/logo_hu673a59176cd62c570f44ed2728665b48_42188_300x300_fit_lanczos_2.png"><meta property="twitter:image" content="/keyple-website/images/logo_hu673a59176cd62c570f44ed2728665b48_42188_300x300_fit_lanczos_2.png"><meta property="og:locale" content="en-us"><meta property="article:modified_time" content="2020-09-25T17:49:46+02:00"><script src=https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.1/cookieconsent.min.js integrity="sha256-5VhCqFam2Cn+yjw61zbBNrbHVJ6SRydPeKopYlngbiQ=" crossorigin=anonymous></script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.1/cookieconsent.min.css integrity="sha256-zQ0LblD/Af8vOppw18+2anxsuaz3pWYyVWi+bTvTH8Q=" crossorigin=anonymous><script>window.addEventListener("load",function(){window.cookieconsent.initialise({"palette":{"popup":{"background":"#1D87BB","text":"#FFFFFF"},"button":{"background":"#FFFFFF","text":"#1D87BB"}},"theme":"classic","type":"opt-in","content":{"header":'Cookiessss used on the website!',"message":"Some Eclipse Foundation pages use cookies to better serve you when you return to the site. You can set your browser to notify you before you receive a cookie or turn off cookies. If you do so, however, some areas of some sites may not function properly. To read Eclipse Foundation Privacy Policy ","allow":"Allow cookies","deny":"Decline","dismiss":"Got it!","link":"click here","href":'https://www.eclipse.org/legal/privacy.php'},})});</script><title>Build your First Android Application | Eclipse Keyple</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents><script>window.staDarkLightChooser=true;</script><script>const isSiteThemeDark=false;</script><script src=/keyple-website/js/load-theme.js></script><aside class=search-results id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href=#><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box><input name=q id=search-query placeholder=Search... autocapitalize=off autocomplete=off autocorrect=off spellcheck=false type=search class=form-control></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/keyple-website/><img src=/keyple-website/images/logo_hu673a59176cd62c570f44ed2728665b48_42188_0x70_resize_lanczos_2.png alt="Eclipse Keyple"></a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/keyple-website/><img src=/keyple-website/images/logo_hu673a59176cd62c570f44ed2728665b48_42188_0x70_resize_lanczos_2.png alt="Eclipse Keyple"></a></div><div class="navbar-collapse main-menu-item collapse justify-content-center" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>What is Eclipse Keyple</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/keyple-website/what-is-keyple/main-features/><span>Keyple's main features</span></a>
<a class=dropdown-item href=/keyple-website/what-is-keyple/what-is-calypso/><span>What is Calypso?</span></a>
<a class=dropdown-item href=/keyple-website/what-is-keyple/who-is-it-for/><span>Who is it for?</span></a>
<a class=dropdown-item href=/keyple-website/what-is-keyple/why-trust/><span>Why trust Eclipse Keyple?</span></a>
<a class=dropdown-item href=/keyple-website/what-is-keyple/overview/><span>Overview</span></a></div></li><li class=nav-item><a class=nav-link href=/keyple-website/components/><span>Components</span></a></li><li class=nav-item><a class=nav-link href=/keyple-website/#news><span>News</span></a></li><li class=nav-item><a class="nav-link active" href=/keyple-website/docs/><span>Documentation</span></a></li><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>Support & Trainings</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/keyple-website/support-trainings/cna/><span>Calypso Networks Association</span></a></div></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=Search><i class="fas fa-search" aria-hidden=true></i></a></li><li class="nav-item dropdown theme-dropdown"><a href=# class="nav-link js-theme-selector" data-toggle=dropdown aria-haspopup=true><i class="fas fa-palette" aria-hidden=true></i></a><div class=dropdown-menu><a href=# class="dropdown-item js-set-theme-light"><span>Light</span></a>
<a href=# class="dropdown-item js-set-theme-dark"><span>Dark</span></a>
<a href=# class="dropdown-item js-set-theme-auto"><span>Automatic</span></a></div></li></ul></div></nav><div class="container-fluid docs"><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 docs-sidebar"><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-3" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation">
<span><i class="fas fa-bars"></i></span></button>
<input name=q type=search class=form-control placeholder=Search... autocomplete=off></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li><a href=/keyple-website/docs/></a></li><div class=docs-toc-item><a class=docs-toc-link href=/keyple-website/docs/architecture/><i class="fas fa-sitemap pr-1"></i>Architecture</a><ul class="nav docs-sidenav"><li><a href=/keyple-website/docs/architecture/keyple-global/>(WIP)Global Architecture</a></li><li><a href=/keyple-website/docs/architecture/keyple-core/>(WIP)Keyple Core</a></li><li><a href=/keyple-website/docs/architecture/keyple-calypso/>(WIP)Keyple Calypso</a></li></ul></div><div class=docs-toc-item><a class=docs-toc-link href=/keyple-website/docs/build-your-first-app/><i class="fas fa-rocket pr-1"></i>Build your First App</a><ul class="nav docs-sidenav"><li><a href=/keyple-website/docs/build-your-first-app/java-app/>(WIP)Java App</a></li><li class=active><a href=/keyple-website/docs/build-your-first-app/android-app/>(WIP)Android App</a></li><li><a href=/keyple-website/docs/build-your-first-app/cpp-app/>(WIP)C++ App</a></li></ul></div><div class=docs-toc-item><a class=docs-toc-link href=/keyple-website/docs/developer-guide/><i class="fas fa-chalkboard-teacher pr-1"></i>Developer Guides</a><ul class="nav docs-sidenav"><li><a href=/keyple-website/docs/developer-guide/develop-ticketing-app/>(WIP)Develop a Ticketing Application</a></li><li><a href=/keyple-website/docs/developer-guide/develop-plugin/>(WIP)Develop a Plugin</a></li><li><a href=/keyple-website/docs/developer-guide/develop-extension/>(WIP)Develop an Extension</a></li><li><a href=/keyple-website/docs/developer-guide/migration-0.8.1-to-0.9.0/>(WIP)Keyple Java 0.8.1 to 0.9.0</a></li></ul></div><div class=docs-toc-item><a class=docs-toc-link href=/keyple-website/docs/api-reference/><i class="fas fa-plug pr-1"></i>API Reference</a></div></ul></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>Contents</a></li></ul><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#compatibility>Compatibility</a></li></ul><ul><li><a href=#sdk-integration>SDK Integration</a><ul><li><a href=#keyple-core>Keyple Core</a></li><li><a href=#keyple-plugins>Keyple Plugins</a></li><li><a href=#keyple-calypso>Keyple Calypso</a></li></ul></li><li><a href=#initializing-the-sdk>Initializing the SDK</a><ul><li><a href=#register-a-plugin>Register a plugin</a></li><li><a href=#retrieve-the-readers>Retrieve the readers</a></li><li><a href=#retrieve-one-specific-reader>Retrieve one specific reader</a></li></ul></li><li><a href=#select-a-po>Select a PO</a><ul><li><a href=#seproxy-api>SeProxy API</a></li><li><a href=#selection-api>Selection API</a></li></ul></li><li><a href=#reading-and-writing-data>Reading and writing data</a><ul><li><a href=#reading-environment-and-usage>Reading Environment and usage</a></li><li><a href=#incrementing-a-counter>Incrementing a counter</a></li></ul></li></ul></nav></div><main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role=main><article class=article><div class=docs-article-container><h1>Build your First Android Application</h1><div class=article-style><h1 id=introduction>Introduction</h1><h2 id=overview>Overview</h2><p>Keyple SDK is supported by the Operating System Android. As Keyple request low level reader access, the key features of
the SDK relies on components called &lsquo;Plugins&rsquo;.</p><p>Keyple Android Plugins are low level implementation of Keyple contracts described in the section &lsquo;Develop a plugin&rsquo; in Developer
guide. Once a plugin is provided, any classic Android application can use Keyple to provide ticketing features.</p><p>This Guide will describe how to start a ticketing application using Keyple SDK.</p><h2 id=compatibility>Compatibility</h2><ul><li>Android OS 19+</li></ul><h1 id=integration>Integration</h1><h2 id=sdk-integration>SDK Integration</h2><h3 id=keyple-core>Keyple Core</h3><p>This high-level API is convenient for developers implementing smart card processing application for terminal interfaced
with smart card readers. Access to the readers is provided by the plugins.</p><p>To use Keyple core API (and in fact, anything keyple&rsquo;s related) import the jar within the gradle dependencies of your
Android application.</p><pre><code class=language-gradle>implementation &quot;org.eclipse.keyple:keyple-java-core:$keyple_version&quot;
</code></pre><p>Please refer to Architecture/Keyle Core</p><h3 id=keyple-plugins>Keyple Plugins</h3><p>There are many Keyple plugins available, the one to use depends on the device and ticketing tools you are aiming to
use.</p><p>For a standard device the keyple-android-plugin-nfc and keyple-android-plugin-omapi should be be used. They will allow keyple to
connect to, respectively, a smart card in the NFC field of the device or, a smart card inserted in a SIM like port. The
plugins for Android are Android Libraries (AAR).</p><p>To use the plugins simply import it within the gradle dependencies of your Android application.</p><pre><code class=language-gradle>implementation &quot;org.eclipse.keyple:keyple-android-plugin-omapi:$keyple_version&quot;
</code></pre><h3 id=keyple-calypso>Keyple Calypso</h3><p>The Keyple Calypso User API is an extension of the Keyple Core User API to manage Calypso Portable Object securely using
Calypso SAM.</p><p>Please refer to Architecture/Keyle Calypso</p><p>To use Keyple Calypso User API simply import the jar within the gradle dependencies of your Android application.</p><pre><code class=language-gradle>implementation &quot;org.eclipse.keyple:keyple-android-plugin-omapi:$keyple_version&quot;
</code></pre><h2 id=initializing-the-sdk>Initializing the SDK</h2><h3 id=register-a-plugin>Register a plugin</h3><p>The Singleton SeProxyService is the entry point of the SE Proxy Service, its instance has to be called by a
ticketing application in order to establish a link with a SE’s application.</p><p>In order to access to SE we have to register at least one plugin.</p><pre><code class=language-kotlin>override fun onCreate(savedInstanceState: Bundle?) {
    super.onCreate(savedInstanceState)
    /* register Omapi Plugin to the SeProxyService */
    try {
        SeProxyService.getInstance().registerPlugin(AndroidOmapiPluginFactory(this))
    } catch (e: KeyplePluginInstantiationException) {
    /* do something with it */
    }
}
</code></pre><h3 id=retrieve-the-readers>Retrieve the readers</h3><p>With the plugin registered we can retrieve all instance of the component mapping the smartcard readers provided by this
plugins. For example, some plugins provide access to contact and contactless readers)</p><pre><code class=language-kotlin>//PLUGIN_NAME is a constant provided by the keyple plugin 
val readers = SeProxyService.getInstance().getPlugin(PLUGIN_NAME).readers
</code></pre><h3 id=retrieve-one-specific-reader>Retrieve one specific reader</h3><p>It is also possible to retrieve a specific reader.</p><pre><code class=language-kotlin>//PLUGIN_NAME and READER_NAME are constants provided by the used keyple plugin 
val reader = SeProxyService.getInstance().getPlugin(PLUGIN_NAME).getReader(READER_NAME)
</code></pre><h2 id=select-a-po>Select a PO</h2><h3 id=seproxy-api>SeProxy API</h3><p>Using a reader, it is possible to select a PO using its AID. Here we use the low level SeProxy API of Keyple core to do so.</p><pre><code class=language-kotlin> /*
 * Configuration of the selector
 * Setting of an AID based selection of a Calypso REV3 PO
 */
val seSelector = SeSelector.builder()
        .seProtocol(SeCommonProtocols.PROTOCOL_ISO7816_3)
        .aidSelector(AidSelector.builder().aidToSelect(poAid).build())
        .build()
//build the request by passing the seSelector. 
//As second parameter of the SeRequest consctructor, an APDU can be added to be executed
//right after the selection.
val seRequest = SeRequest(seSelector, null)

//A ProxyReader is a physical reader, it allows to send and receive synchronised APDUS
val seResponse = (reader.value as ProxyReader).transmitSeRequest(seRequest, ChannelControl.KEEP_OPEN)

//Check is selection is successful
if (seResponse?.selectionStatus?.hasMatched() == true) {
    //Selection is done
} else {
    //Selection failed
}
</code></pre><h3 id=selection-api>Selection API</h3><p>The bellow example illustrates the same operation using the Selection API, an higher level API of Keyple Core.</p><pre><code class=language-kotlin>var seSelection = SeSelection()

/* 
 * Close the channel after the selection 
 */
seSelection.prepareReleaseSeChannel()

/*
 * AID based selection: get the first application occurrence matching the AID, keep the
 * physical channel open
 */
seSelection.prepareSelection(GenericSeSelectionRequest(
        SeSelector.builder()
                .seProtocol(SeCommonProtocols.PROTOCOL_ISO14443_4)
                .aidSelector(AidSelector.builder()
                        .aidToSelect(seAidPrefix)
                        .fileOccurrence(AidSelector.FileOccurrence.FIRST)
                        .fileControlInformation(AidSelector.FileControlInformation.FCI).build())
                .build()))
seSelection.prepareSelection(poSelectionRequest)

/*
 * Execution og the selection
 */
val selectionsResult = seSelection.processExplicitSelection(reader)

/**
 * Check if PO has been selected successfuly
 */
if (selectionsResult.hasActiveSelection()) {
    //Selection is done
    val matchedSe = selectionsResult.activeMatchingSe
    val fci = matchedSe.fciBytes
    val atr = matchedSe.atrBytes
} else {
    //Selection failed
}
</code></pre><h2 id=reading-and-writing-data>Reading and writing data</h2><h3 id=reading-environment-and-usage>Reading Environment and usage</h3><p>Exemple of reading Environmement and usage data of an Hoplink application. As Hoplink is a calypso application, we can map
cast the result of the selection with CalypsoPo. It will allow us to easily access calypso datas.</p><pre><code class=language-kotlin>var poAid= &quot;A000000291A000000191&quot;
val sfiHoplinkEFEnvironment = 0x14.toByte()
val sfiHoplinkEFUsage = 0x1A.toByte()

/*
 * Prepare a Calypso PO selection
 */
val seSelection = SeSelection()

/*
 * Setting of an AID based selection of a Calypso REV3 PO
 *
 * Select the first application matching the selection AID whatever the SE
 * communication protocol keep the logical channel open after the selection
 */

/*
 * Calypso selection: configures a PoSelectionRequest with all the desired
 * attributes to make the selection and read additional information afterwards
 */
val poSelectionRequest = PoSelectionRequest(
        PoSelector.builder()
                .seProtocol(SeCommonProtocols.PROTOCOL_ISO7816_3)
                .aidSelector(AidSelector.builder().aidToSelect(poAid).build())
                .invalidatedPo(InvalidatedPo.REJECT).build())

/*
 * Prepare the reading order and keep the associated parser for later use once
 * the selection has been made.
 */
poSelectionRequest.prepareReadRecordFile(sfiHoplinkEFEnvironment, 1)

poSelectionRequest.prepareReadRecordFile(
        sfiHoplinkEFUsage, 1)

/*
 * Add the selection case to the current selection (we could have added other
 * cases here)
 *
 * Ignore the returned index since we have only one selection here.
 */
seSelection.prepareSelection(poSelectionRequest)

/*
 * Actual PO communication: operate through a single request the Calypso PO
 * selection and the file read
 */
try {
    val selectionsResult = seSelection.processExplicitSelection(seReader)

    if (selectionsResult.hasActiveSelection()) {
        val calypsoPo = selectionsResult.activeMatchingSe as CalypsoPo
        val environmentAndHolder = calypsoPo.getFileBySfi(sfiHoplinkEFEnvironment).data.content
        val usage = calypsoPo.getFileBySfi(sfiHoplinkEFUsage).data.content
    } else {
       //The selection of the PO Failed
    }
} catch (e: Exception) {
    //The selection of the PO Failed with an error
}

</code></pre><h3 id=incrementing-a-counter>Incrementing a counter</h3><p>In this example, we&rsquo;ll increase Counter 1 by 10 on a contactless ticketing NFC PO. The counter will be increased
when the PO will enter NFC Field.</p><h4 id=setup-to-catch-reader-event>Setup to catch reader event</h4><pre><code class=language-kotlin>/*
 * In order to received readers events (Inserted, removed etc..), the interface ObservableReader.ReaderObserver must be 
 * implemented.
 *    
 */

import org.eclipse.keyple.core.seproxy.event.ObservableReader
import org.eclipse.keyple.core.seproxy.event.ReaderEvent

class MainActivity : ObservableReader.ReaderObserver{

    //Initialise Android NFC Reader
    override fun initReaders() {
      // Initialize SEProxy with Android Plugins
        val nfcPlugin = SeProxyService.getInstance().registerPlugin(AndroidNfcPluginFactory())
        //Example of plugin for device with a sam reader
        val samPlugin = SeProxyService.getInstance().registerPlugin(AndroidFamocoPluginFactory())

        // Configuration of AndroidNfc Reader
        poReader = nfcPlugin.getReader(AndroidNfcReader.READER_NAME) as AndroidNfcReader
        poReader.setParameter(&quot;FLAG_READER_RESET_STATE&quot;, &quot;0&quot;)
        poReader.setParameter(&quot;FLAG_READER_PRESENCE_CHECK_DELAY&quot;, &quot;100&quot;)
        poReader.setParameter(&quot;FLAG_READER_NO_PLATFORM_SOUNDS&quot;, &quot;0&quot;)
        poReader.setParameter(&quot;FLAG_READER_SKIP_NDEF_CHECK&quot;, &quot;0&quot;)
        
        (poReader as ObservableReader).addObserver(this)
        (poReader as ObservableReader).addSeProtocolSetting(SeCommonProtocols.PROTOCOL_ISO14443_4, 
                                            AndroidNfcProtocolSettings.getSetting(SeCommonProtocols.PROTOCOL_ISO14443_4))
    }

    // Reader event will be caught in this method
    override fun update(event: ReaderEvent?) {
        CoroutineScope(Dispatchers.Main).launch {
            when (event?.eventType) {
                ReaderEvent.EventType.SE_MATCHED -&gt; {
                    //PO with set AID detected
                    samReader.setParameter(AndroidFamocoReader.FLAG_READER_RESET_STATE, &quot;&quot;)
                    val samResource = checkSamAndOpenChannel(samReader)

                    val selectionsResult = seSelection.processDefaultSelection(event.defaultSelectionsResponse)
                    if (selectionsResult.hasActiveSelection()) {
                        val calypsoPo = selectionsResult.activeMatchingSe as CalypsoPo
                        val poTransaction = PoTransaction(SeResource(poReader, calypsoPo), getSecuritySettings(samResource))
                        when (transactionType) {
                            TransactionType.INCREASE -&gt; {
                                /*
                                * Open Session for the debit key
                                */
                                poTransaction.processOpening(PoTransaction.SessionSetting.AccessLevel.SESSION_LVL_LOAD)

                                poTransaction.prepareReadRecordFile(CalypsoClassicInfo.SFI_Counter1, CalypsoClassicInfo.RECORD_NUMBER_1.toInt())
                                poTransaction.processPoCommandsInSession()
        
                                //Process PO increase counter by 10
                                poTransaction.prepareIncreaseCounter(CalypsoClassicInfo.SFI_Counter1, CalypsoClassicInfo.RECORD_NUMBER_1.toInt(), 10)
                                poTransaction.processClosing(ChannelControl.CLOSE_AFTER)
                                addResultEvent(&quot;Increase by 10: SUCCESS&quot;)
                            }
                        }
                    }
                    //Notifying Keyple that we handled event
                    (poReader as ObservableReader).notifySeProcessed()
                }

                ReaderEvent.EventType.SE_INSERTED -&gt; {
                    //PO detected but AID didn't match with AID set

                    //Notifying Keyple that we handled event
                    (poReader as ObservableReader).notifySeProcessed()
                }

                ReaderEvent.EventType.SE_REMOVED -&gt; {
                    //Action when SE is Removed
                }

                ReaderEvent.EventType.TIMEOUT_ERROR -&gt; {
                    //Action when timeout with SE
                }
            }
        }
    }
}
</code></pre><h4 id=launch-detection>Launch detection</h4><pre><code class=language-kotlin>   /* Prepare a Calypso PO selection */
   val seSelection = SeSelection(MultiSeRequestProcessing.FIRST_MATCH)
   
    /* Calypso selection: configures a PoSelector with all the desired attributes to make the selection and read additional information afterwards */
   val poSelectionRequest = PoSelectionRequest(PoSelector.builder()
        .seProtocol(SeCommonProtocols.PROTOCOL_ISO14443_4)
        .aidSelector(SeSelector.AidSelector.builder().aidToSelect(CalypsoClassicInfo.AID).build())
        .invalidatedPo(PoSelector.InvalidatedPo.REJECT).build())

    /* Prepare the reading order */
    poSelectionRequest.prepareReadRecordFile(CalypsoClassicInfo.SFI_EnvironmentAndHolder, CalypsoClassicInfo.RECORD_NUMBER_1.toInt())

    /*
     * Add the selection request to the current selection (we could have added other request
     * here)
     */
    seSelection.prepareSelection(poSelectionRequest)

    /*
    * Provide the SeReader with the selection operation to be processed when a PO is
    * inserted.
    */
    (poReader as ObservableReader).setDefaultSelectionRequest(seSelection.selectionOperation,
        ObservableReader.NotificationMode.MATCHED_ONLY)

    // notify reader that se detection has been launched
    poReader.startSeDetection(ObservableReader.PollingMode.REPEATING)
</code></pre><p>#FAQ:</p><p>When should I use the Selection API instead of SeProxy API?</p></div><div class=article-widget><div class=post-nav><div class=post-nav-item><div class=meta-nav>Previous</div><a href=/keyple-website/docs/build-your-first-app/java-app/ rel=next>Build your First Java Application</a></div><div class=post-nav-item><div class=meta-nav>Next</div><a href=/keyple-website/docs/build-your-first-app/cpp-app/ rel=prev>Build your First C++ Application</a></div></div></div></div><div class=body-footer><p>Last updated on Fri, Sep 25, 2020</p></div></article><style type=text/css media=screen>footer{background-color:#1d87bb}footer a{color:#fff}footer ul{padding-left:0}footer li{line-height:1.42857143;position:relative;display:block;color:#fff}</style><footer class=site-footer><div class=container><div class="row featurette"><div class="col-12 col-sm-4"><h4>More</h4><ul><li><a href=https://github.com/eclipse/keyple title="View Source Code on GitHub"><i class="fab fa-github"></i>GitHub Repository</a></li><li><a href=https://twitter.com/keyple_org title="Follow us on Twitter"><i class="fab fa-twitter"></i>Twitter</a></li><li><a href=https://accounts.eclipse.org/mailing-list/keyple-user title="Keyple progress information and user discussions"><i class="fas fa-envelope"></i>User mailing list</a></li><li><a href=https://accounts.eclipse.org/mailing-list/keyple-dev title="Keyple developer discussions"><i class="fas fa-envelope"></i>Developer mailing list</a></li></ul></div><div class="col-12 col-sm-4"><h4>Eclipse Foundation</h4><ul><li><a href=https://www.eclipse.org/org/>About Eclipse Foundation</a></li><li><a href=https://www.eclipse.org/org/foundation/contact.php>Contact Eclipse Foundation</a></li><li><a href=https://www.eclipse.org/donate>Donate</a></li><li><a href=https://www.eclipse.org/membership>Members</a></li><li><a href=https://www.eclipse.org/org/documents/>Governance</a></li><li><a href=https://www.eclipse.org/org/documents/Community_Code_of_Conduct.php>Code of Conduct</a></li><li><a href=https://www.eclipse.org/artwork/>Logo and Artwork</a></li><li><a href=https://www.eclipse.org/org/foundation/directors.php></a></li></ul></div><div class="col-12 col-sm-4"><h4>Legal</h4><ul><li><a href=https://www.eclipse.org/legal/privacy.php>Privacy Policy</a></li><li><a href=https://www.eclipse.org/legal/termsofuse.php>Terms of Use</a></li><li><a href=https://www.eclipse.org/legal/copyright.php>Copyright Agent</a></li><li><a href=https://www.eclipse.org/legal/epl-2.0/>Eclipse Public License</a></li><li><a href=https://www.eclipse.org/legal/>Legal Resources</a></li><li><a href=https://eclipse.org/security/ target=_blank>Report a Vulnerability</a></li></ul></section></div></div><p class=powered-by>Copyright © Eclipse Foundation, Inc. All Rights Reserved.</p><p class=powered-by>Powered by the
<a href=https://sourcethemes.com/academic/ target=_blank rel=noopener>Academic theme</a> for
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a>.
<span class=float-right aria-hidden=true><a href=# class=back-to-top><span class=button_icon><i class="fas fa-chevron-up fa-2x"></i></span></a></span></p></footer></main></div></div><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/instant.page/5.1.0/instantpage.min.js integrity="sha512-1+qUtKoh9XZW7j+6LhRMAyOrgSQKenQ4mluTR+cvxXjP1Z54RxZuzstR/H9kgPXQsVB8IW7DMDFUJpzLjvhGSQ==" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/highlight.min.js integrity="sha512-7t8APmYpzEsZP7CYoA7RfMPV9Bb+PJHa9x2WiUnDXZx3XHveuyWUtvNOexhkierl5flZ3tr92dP1mMS+SGlD+A==" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/languages/java.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/languages/kotlin.min.js></script><script>const code_highlighting=true;</script><script>const search_config={"indexURI":"/keyple-website/index.json","minLength":1,"threshold":0.3};const i18n={"no_results":"No results found","placeholder":"Search...","results":"results found"};const content_type={'post':"Posts",'project':"Projects",'publication':"Publications",'talk':"Talks",'slides':"Slides"};</script><script src=https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js integrity="sha256-pB/deHc9CGfFpJRjC43imB29Rse8tak+5eXqntO94ck=" crossorigin=anonymous></script><script>anchors.add();</script><script id=search-hit-fuse-template type=text/x-template>
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script><script src=https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin=anonymous></script><script src=/keyple-website/js/academic.min.685aa588f098e3a2bb14612211c3de9e.js></script><div id=modal class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><h5 class=modal-title>Cite</h5><button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&#215;</span></button></div><div class=modal-body><pre><code class="tex hljs"></code></pre></div><div class=modal-footer><a class="btn btn-outline-primary my-1 js-copy-cite" href=# target=_blank><i class="fas fa-copy"></i>Copy</a>
<a class="btn btn-outline-primary my-1 js-download-cite" href=# target=_blank><i class="fas fa-download"></i>Download</a><div id=modal-error></div></div></div></div></div></body></html>